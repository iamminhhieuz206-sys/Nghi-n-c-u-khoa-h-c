import os
import shutil
import random
from glob import glob

# ==== PATH 3 folder c·ªßa b·∫°n ====
datasets = [
    "canh_bi_do",
    "chao_trang",
    "trung_chien"
]

# ==== T·∫°o dataset output ====
output_base = "dataset"
output_images = os.path.join(output_base, "images")
output_labels = os.path.join(output_base, "labels")

splits = ["train", "val", "test"]

# T·∫°o th∆∞ m·ª•c output
for split in splits:
    os.makedirs(os.path.join(output_images, split), exist_ok=True)
    os.makedirs(os.path.join(output_labels, split), exist_ok=True)

# Thu th·∫≠p to√†n b·ªô file ·∫£nh (png, jpg, jpeg)
all_images = []
extensions = ["*.png", "*.jpg", "*.jpeg", "*.PNG", "*.JPG", "*.JPEG"]

for d in datasets:
    for ext in extensions:
        all_images.extend(glob(os.path.join(d, ext)))

print("T·ªïng s·ªë ·∫£nh =", len(all_images))

# Shuffle
random.shuffle(all_images)

# T·ª∑ l·ªá chia
total = len(all_images)
train_split = int(0.7 * total)
val_split = int(0.2 * total)

train_files = all_images[:train_split]
val_files = all_images[train_split:train_split + val_split]
test_files = all_images[train_split + val_split:]

def copy_files(file_list, split_name):
    for img_path in file_list:
        base = os.path.splitext(img_path)[0]
        label_path = base + ".txt"

        # Copy ·∫£nh
        shutil.copy(img_path, os.path.join(output_images, split_name))

        # Copy nh√£n
        if os.path.exists(label_path):
            shutil.copy(label_path, os.path.join(output_labels, split_name))
        else:
            print("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y label cho:", img_path)

# Ch·∫°y copy
copy_files(train_files, "train")
copy_files(val_files, "val")
copy_files(test_files, "test")

print("üéâ DONE! Dataset YOLO ƒë√£ ƒë∆∞·ª£c g·ªôp & chia xong!")
